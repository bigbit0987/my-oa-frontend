# OAé¡¹ç›®ç®¡ç†ç³»ç»Ÿ - å‰ç«¯ç³»ç»ŸæŠ€æœ¯æ¶æ„ç™½çš®ä¹¦

> **ç‰ˆæœ¬å·**: v2.0
> **æœ€åæ›´æ–°**: 2025-12-25
> **çŠ¶æ€**: æ­£å¼ç‰ˆ

## 1. ğŸ“– å¼•è¨€

### 1.1 ç¼–å†™ç›®çš„
æœ¬æ–‡æ¡£æ—¨åœ¨æ˜ç¡® "OAé¡¹ç›®ç®¡ç†ç³»ç»Ÿ" å‰ç«¯å·¥ç¨‹çš„æŠ€æœ¯è·¯çº¿ã€æ ¸å¿ƒæ¶æ„è®¾è®¡ã€å·¥ç¨‹è§„èŒƒåŠå…³é”®ä¸šåŠ¡å®ç°çš„åº•å±‚é€»è¾‘ï¼Œä¸ºå¼€å‘å›¢é˜Ÿæä¾›ç»Ÿä¸€çš„æŠ€æœ¯å‡†åˆ™ï¼Œç¡®ä¿ç³»ç»Ÿçš„é«˜å¯ç»´æŠ¤æ€§ã€æ‰©å±•æ€§ä¸å®‰å…¨æ€§ã€‚

### 1.2 é€‚ç”¨èŒƒå›´
æœ¬æ–‡æ¡£é€‚ç”¨äºå‚ä¸æœ¬é¡¹ç›®çš„å‰ç«¯å¼€å‘äººå‘˜ã€æ¶æ„å¸ˆä»¥åŠéœ€è¦è¿›è¡Œå‰åç«¯æ¥å£å¯¹æ¥çš„åå°å¼€å‘äººå‘˜ã€‚

---

## 2. ğŸ—ï¸ æŠ€æœ¯é€‰å‹ (Tech Stack)

æœ¬é¡¹ç›®é‡‡ç”¨ **"Modern React"** ç°ä»£åŒ–æŠ€æœ¯æ ˆï¼Œæ³¨é‡æ€§èƒ½ã€å¼€å‘ä½“éªŒä¸ç±»å‹å®‰å…¨ã€‚

### 2.1 æ ¸å¿ƒæ¡†æ¶
| æ¨¡å— | æŠ€æœ¯é€‰å‹ | ç‰ˆæœ¬ | é€‰å‹ç†ç”± |
| :--- | :--- | :--- | :--- |
| **View Engine** | **React** | **18.3+** | ä¸šç•Œæ ‡å‡†ï¼Œåˆ©ç”¨ Hooks å’Œ Concurrent Mode æå‡æ€§èƒ½ã€‚ |
| **Build Tool** | **Vite** | **7.2+** | æé€Ÿå†·å¯åŠ¨ä¸ HMR çƒ­æ›´æ–°ï¼Œæ˜¾è‘—æå‡å¼€å‘æ•ˆç‡ã€‚ |
| **Language** | **TypeScript** | **5.9+** | å¼ºç±»å‹çº¦æŸï¼Œæ„å»ºå¥å£®çš„ä¼ä¸šçº§åº”ç”¨ã€‚ |

### 2.2 UI ä¸ æ ·å¼ç³»ç»Ÿ
é‡‡ç”¨ **"CSS-in-JS + Atomic CSS"** åŒå¼•æ“æ¨¡å¼ï¼š
*   **ç»„ä»¶åº“**: **Ant Design 5** (v5.29+)
    *   ä½¿ç”¨ ConfigProvider å®ç°å…¨å±€ä¸»é¢˜ Tokens é…ç½®ã€‚
    *   åˆ©ç”¨ Design Tokens ä¿æŒè§†è§‰ä¸€è‡´æ€§ã€‚
*   **åŸå­æ ·å¼**: **Tailwind CSS v4** (v4.0+)
    *   `src/index.css` é€šè¿‡ `@theme` å®šä¹‰ä¸ AntD ä¸€è‡´çš„ CSS å˜é‡ï¼ˆå¦‚ `--color-primary`ï¼‰ã€‚
    *   è´Ÿè´£ Layout (Flex/Grid)ã€Spacing (m/p)ã€Typography (text-*) ç­‰å¸ƒå±€æ ·å¼ã€‚
*   **Icons**: `@ant-design/icons`

### 2.3 æ ¸å¿ƒä¸šåŠ¡å¼•æ“
*   **åŠ¨æ€è¡¨å•**: **Formily** (v2.3+)
    *   **æ ¸å¿ƒä»·å€¼**: é€šè¿‡ JSON Schema é©±åŠ¨æ¸²æŸ“ 40+ ä¸ªå¤æ‚ä¸šåŠ¡è¡¨å•ï¼Œå®ç°åç«¯é…ç½®åŒ–è¡¨å•é€»è¾‘ï¼Œå‡å°‘å‰ç«¯ç¡¬ç¼–ç ã€‚
    *   **æ¶æ„**: `@formily/core` (æ¨¡å‹å±‚) + `@formily/react` (è§†å›¾å±‚) + `@formily/antd-v5` (ç»„ä»¶æ¡¥æ¥)ã€‚
*   **çŠ¶æ€ç®¡ç†**: **Zustand** (v5.0+)
    *   è½»é‡çº§ã€Hooks é£æ ¼çš„å…¨å±€çŠ¶æ€ç®¡ç†ï¼Œç”¨äº UserStore (è®¤è¯)ã€ConfigStore (å…¨é…ç½®) ç­‰ã€‚
*   **ç½‘ç»œè¯·æ±‚**: **Axios** (v1.13+)
    *   å°è£…æ‹¦æˆªå™¨å¤„ç† JWT Token æ³¨å…¥ã€401 è‡ªåŠ¨è·³è½¬ã€å…¨å±€é”™è¯¯æç¤ºã€‚

---

## 3. ğŸ§© ç³»ç»Ÿæ¶æ„è®¾è®¡

### 3.1 åŠ¨æ€è¡¨å•æ¸²æŸ“æ¶æ„ (Form Data Driven)
ç³»ç»Ÿæ ¸å¿ƒæ˜¯ **Process Center (æµç¨‹ä¸­å¿ƒ)**ï¼Œå…¶ä¸šåŠ¡è¡¨å•å…¨éƒ¨ç”±åç«¯ä¸‹å‘ JSON Schema é©±åŠ¨æ¸²æŸ“ã€‚

1.  **Schema æ¥æºå±‚**:
    *   **Remote**: ç”Ÿäº§ç¯å¢ƒä»åç«¯ API (`/api/v1/form-permissions/runtime/...`) è·å–å¸¦æƒé™æ§åˆ¶çš„ Schemaã€‚
    *   **Local Mock**: å¼€å‘ç¯å¢ƒé€šè¿‡ `src/services/schema.ts` æ‹¦æˆªï¼Œä¼˜å…ˆè¯»å– `src/mocks/schemas/*.json`ã€‚
2.  **æ¸²æŸ“é€‚é…å±‚**:
    *   `FormilyRenderer` ç»„ä»¶æ¥æ”¶ Schemaã€‚
    *   è§£æ `x-pattern` (readPretty/editable/disabled) æ§åˆ¶å­—æ®µçŠ¶æ€ã€‚
    *   é€šè¿‡ `x-reactions` å®ç°å­—æ®µè”åŠ¨ï¼ˆå¦‚ï¼šé€‰æ‹©â€œæ˜¯â€æ˜¾ç¤ºéšè—é¢æ¿ï¼‰ã€‚
3.  **UI å‘ˆç°å±‚**:
    *   è‡ªåŠ¨æ˜ å°„åˆ° Ant Design ç»„ä»¶ (Input, Select, DatePicker, Upload)ã€‚

#### ğŸ“Š Schema åŠ è½½æµç¨‹å›¾
```mermaid
flowchart LR
    subgraph å‰ç«¯
        A[TaskHandle é¡µé¢] --> B{å¼€å‘ç¯å¢ƒ?}
        B -- æ˜¯ --> C[schema.ts æ‹¦æˆª]
        C --> D[è¯»å– doc/forms/*.json]
        B -- å¦ --> E[è¯·æ±‚åç«¯ API]
        E --> F["/api/v1/.../schema"]
        D --> G[FormilyRenderer]
        F --> G
        G --> H[Ant Design ç»„ä»¶]
    end
```

#### ğŸ“Š ä»»åŠ¡åŠç†æ—¶åºå›¾
```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant FE as å‰ç«¯
    participant BE as åç«¯
    U->>FE: æ‰“å¼€ä»»åŠ¡è¯¦æƒ…
    FE->>BE: GET /tasks/{id}/schema
    BE-->>FE: Schema + FormData + Permissions
    FE->>FE: FormilyRenderer æ¸²æŸ“
    U->>FE: å¡«å†™è¡¨å• & ç‚¹å‡»åŒæ„
    FE->>FE: Formily æ ¡éªŒ
    FE->>BE: POST /tasks/{id}/complete
    BE-->>FE: æˆåŠŸå“åº”
    FE->>U: Message.success æç¤º
```

### 3.2 å®‰å…¨æ¶æ„ (Security)
*   **è®¤è¯ (Authentication)**:
    *   åŸºäº **JWT (JSON Web Token)** æ ‡å‡†ã€‚
    *   Token å­˜å‚¨äº localStorageï¼Œé€šè¿‡ `userStore` åŒæ­¥çŠ¶æ€ã€‚
*   **é˜²æ³„å¯†æ°´å° (Watermark)**:
    *   å…¨å±€ç»„ä»¶ `WatermarkWrapper` åŒ…è£¹ä¸»è¦å†…å®¹åŒºã€‚
    *   åŠ¨æ€ç”Ÿæˆ "ç”¨æˆ·å§“å + æ‰‹æœºå°¾å·" æ°´å°ï¼Œé˜²æ­¢æ•æ„Ÿæ•°æ®æˆªå±æ³„éœ²ã€‚
*   **æƒé™æ§åˆ¶ (RBAC)**:
    *   **èœå•çº§**: è·¯ç”±å®ˆå«æ ¹æ®ç”¨æˆ·è§’è‰²è¿‡æ»¤èœå•ã€‚
    *   **å­—æ®µçº§**: è¡¨å•å­—æ®µçš„ Read/Write/Hidden æƒé™ç”±åç«¯è®¡ç®—åç›´æ¥æ³¨å…¥ Schemaï¼Œå‰ç«¯æ— éœ€ç¼–å†™æƒé™åˆ¤æ–­ä»£ç ã€‚

### 3.3 ç›®å½•ç»“æ„è§„èŒƒ
```text
src/
â”œâ”€â”€ assets/                 # é™æ€èµ„æº
â”œâ”€â”€ components/             # é€šç”¨ä¸šåŠ¡ç»„ä»¶
â”‚   â”œâ”€â”€ FormilyRenderer/    # [æ ¸å¿ƒ] åŠ¨æ€è¡¨å•å¼•æ“
â”‚   â”œâ”€â”€ ProcessTimeline/    # æµç¨‹å®¡æ‰¹æ—¶é—´çº¿
â”‚   â”œâ”€â”€ ProcessDiagram/     # BPMN æµç¨‹å›¾é¢„è§ˆ
â”‚   â””â”€â”€ WatermarkWrapper/   # å®‰å…¨æ°´å°å®¹å™¨
â”œâ”€â”€ layouts/                # å¸ƒå±€å®¹å™¨
â”‚   â”œâ”€â”€ MainLayout/         # æ ¸å¿ƒå¸ƒå±€ (ProLayout)
â”‚   â””â”€â”€ AuthLayout/         # ç™»å½•é¡µå¸ƒå±€
â”œâ”€â”€ pages/                  # é¡µé¢è§†å›¾ (æŒ‰ä¸šåŠ¡åŸŸåˆ’åˆ†)
â”‚   â”œâ”€â”€ Dashboard/          # å·¥ä½œå° (Bento Grid)
â”‚   â”œâ”€â”€ Process/            # æµç¨‹ä¸­å¿ƒ (TaskHandle, Initiate)
â”‚   â”œâ”€â”€ Project/            # é¡¹ç›®ä¸­å¿ƒ (Ledger, Detail)
â”‚   â””â”€â”€ Admin/              # ç³»ç»Ÿç®¡ç†
â”œâ”€â”€ services/               # API æœåŠ¡å±‚ (Axios)
â”‚   â”œâ”€â”€ auth.ts             # è®¤è¯æœåŠ¡
â”‚   â”œâ”€â”€ task.ts             # ä»»åŠ¡ä¸æµç¨‹æœåŠ¡
â”‚   â”œâ”€â”€ project.ts          # é¡¹ç›®æœåŠ¡
â”‚   â””â”€â”€ schema.ts           # Schema åŠ è½½ç­–ç•¥
â”œâ”€â”€ stores/                 # Zustand çŠ¶æ€ä»“åº“
â””â”€â”€ utils/                  # å·¥å…·å‡½æ•°
```

---

## 4. ğŸ”Œ API æ¥å£è§„èŒƒ

### 4.1 åŸºç¡€çº¦å®š
*   **Base URL**: `/api/v1`
*   **Content-Type**: `application/json`
*   **Auth Header**: `Authorization: Bearer <token>`

### 4.2 ç»Ÿä¸€å“åº”æ ¼å¼
```json
{
  "success": true,
  "data": { ... },       // ä¸šåŠ¡æ•°æ® payload
  "error": {             // ä»… success=false æ—¶å­˜åœ¨
    "code": "BUSINESS_ERROR",
    "message": "ä»»åŠ¡å·²è¢«å¤„ç†ï¼Œæ— æ³•å†æ¬¡æäº¤"
  },
  "timestamp": "2025-12-25T12:00:00Z"
}
```

### 4.3 æ ¸å¿ƒäº¤äº’æµç¨‹
#### 4.3.1 ä»»åŠ¡åŠç† (Task Execution)
1.  **åŠ è½½**: å‰ç«¯è°ƒç”¨ `GET /tasks/{taskId}/schema` è·å– `Schema` (è¡¨å•ç»“æ„) å’Œ `Value` (å›å¡«æ•°æ®)ã€‚
2.  **æ¸²æŸ“**: `FormilyRenderer` æ¸²æŸ“è¡¨å•ï¼Œ`ProcessTimeline` æ¸²æŸ“å®¡æ‰¹è®°å½•ã€‚
3.  **åŠ¨ä½œ**: ç”¨æˆ·ç‚¹å‡»â€œåŒæ„/é©³å›â€ -> å‰ç«¯æ ¡éªŒè¡¨å• -> `POST /tasks/{taskId}/complete` æäº¤æ•°æ®ã€‚

#### 4.3.2 åŠ¨æ€é€‰äºº (Dynamic Assignee)
å¯¹äºâ€œè½¬åŠâ€ã€â€œåŠ ç­¾â€ç­‰æ“ä½œï¼Œå‰ç«¯éœ€è°ƒç”¨ User Select ç»„ä»¶ï¼Œé€‰æ‹©åå°† `targetUserId` ä¸€å¹¶æäº¤ç»™åç«¯æ¥å£ã€‚

---

## 5. ğŸš€ æ€§èƒ½ä¸ä¼˜åŒ–ç­–ç•¥

1.  **è·¯ç”±æ‡’åŠ è½½ (Code Splitting)**:
    *   ä½¿ç”¨ `React.lazy` å’Œ `Suspense` å¯¹ `pages/*` ä¸‹çš„é¡µé¢è¿›è¡ŒæŒ‰éœ€åŠ è½½ï¼Œå‡å°é¦–å±åŒ…ä½“ç§¯ã€‚
2.  **Schema ç¼“å­˜ä¼˜åŒ–**:
    *   ä¸šåŠ¡Schemaä½“ç§¯è¾ƒå¤§ï¼Œå»ºè®®åˆ©ç”¨æµè§ˆå™¨ HTTP ç¼“å­˜ï¼ˆé…åˆ ETagï¼‰ï¼Œä½†éœ€ç¡®ä¿ç‰ˆæœ¬ä¸€è‡´æ€§ã€‚
3.  **è™šæ‹Ÿæ»šåŠ¨**:
    *   é¡¹ç›®å°è´¦ (`ProjectList`) å¯èƒ½åŒ…å«æ•°åƒæ¡æ•°æ®ï¼Œ`ProTable` å¼€å¯ `virtual` æ¨¡å¼ä¿è¯æµç•…æ»šåŠ¨ã€‚
4.  **æ„å»ºä¼˜åŒ–**:
    *   Vite ç”Ÿäº§ç¯å¢ƒæ„å»ºç§»é™¤ `console.log`ï¼Œå¯ç”¨ Gzip å‹ç¼©ã€‚

---
