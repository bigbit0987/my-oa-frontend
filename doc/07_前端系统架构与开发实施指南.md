# 前端系统架构与开发实施指南

> **最后更新**: 2024-12-24  
> **状态**: 规划中  
> **关联决策**: [ADR-006 前端技术架构与设计规范](./adr/ADR-006-前端技术架构与设计规范.md)

---

## 🏗️ 1. 目录结构规范

基于 `Vite` + `React` 的轻量化重构目录结构：

```text
src/
├── assets/                 # 静态资源 (Images, Global Styles)
├── components/             # 通用组件库
│   ├── FormilyRenderer/    # [已完成] 动态表单渲染核心引擎
│   ├── ProcessTimeline/    # [待开发] 流程进度可视化组件
│   ├── ProcessDiagram/     # [待开发] BPMN 流程图查看器 (SVG/Canvas)
│   ├── BentoCard/          # [待开发] 仪表盘通用卡片容器
│   ├── WatermarkWrapper/   # [待开发] 全局防泄密水印容器
│   └── StatusTag/          # [待开发] 统一状态标签 (审批中/已完成/驳回)
├── layouts/                # 布局容器
│   ├── MainLayout/         # 核心布局 (基于 ProLayout)
│   │   ├── index.tsx
│   │   └── _menu.tsx       # 菜单配置
│   └── AuthLayout.tsx      # 登录页布局
├── pages/                  # 页面视图 (按功能域划分)
│   ├── dashboard/          # [工作台]
│   │   ├── index.tsx       # 仪表盘主页
│   │   └── components/     # 仪表盘专用小组件 (如 TaskListCard)
│   ├── process/            # [流程中心]
│   │   ├── TodoList.tsx    # 待办任务列表 (ProTable)
│   │   ├── HistoryList.tsx # 已办历史
│   │   ├── TaskHandle/     # 任务办理详情页 (核心)
│   │   │   ├── index.tsx
│   │   │   └── components/ # 审批栏、意见区
│   │   └── MyRequest.tsx   # 我的申请
│   ├── project/            # [项目中心]
│   │   ├── ProjectList.tsx # 项目台账 (ProTable)
│   │   └── ProjectProfile/ # 项目详情大屏
│   │       ├── index.tsx   # 骨架与 Header
│   │       ├── Overview.tsx# 项目概况 Tab
│   │       ├── Plan.tsx    # 策划书 Tab
│   │       ├── Finance.tsx # [New] 成本/合同/回款看板
│   │       ├── Team.tsx    # [New] 团队成员与工时视图
│   │       └── Files.tsx   # 附件柜 Tab
│   └── admin/              # [系统管理]
│       ├── UserManage.tsx
│       └── PermConfig.tsx  # 表单权限配置矩阵
├── services/               # API 接口层 (基于 Axios)
│   ├── auth.ts
│   ├── task.ts             # 任务相关接口
│   ├── project.ts          # 项目相关接口
│   └── schema.ts           # [核心] 表单协议加载与解析
├── stores/                 # 全局状态管理 (Zustand)
│   ├── userStore.ts        # 用户信息、Token
│   └── configStore.ts      # 主题、全局配置
└── utils/                  # 工具函数
```

---

## 🧩 2. 核心功能域设计

### 2.1 工作台 (Dashboard) - "Morning Hub"
*   **设计理念**: Bento Grid (便当盒) 布局，信息高密度聚合。
*   **核心组件**:
    *   **KPI 卡片**: 待办数 (醒目红)、进行中项目数。
    *   **紧急待办清单**: Top 5 优先级最高的任务，带倒计时。
    *   **快捷发起**: 高频流程入口 (4-6个图标)。
    *   **项目概览**: 关注项目的进度条展示。

### 2.2 流程中心 (Process Center) - "The Factory"
*   **页面**: `TaskHandle` (任务办理页) 是系统的心脏。
*   **布局**: 三段式设计
    *   **左侧 (Main)**: Formily 动态表单区域。
    *   **右侧 (Sidebar)**: 审批流转记录 (TimeLine) + 流程图预览。
    *   **底部 (Footer)**: 吸底操作栏 (同意/驳回/转办)，确保操作永远可见。

### 2.3 项目中心 (Project Center) - "Digital Archive"
*   **页面**: `ProjectProfile` (项目详情大屏)
*   **交互**:
    *   **Sticky Header**: 滚动时项目基础信息吸顶。
    *   **Visual Timeline**: 顶部的项目阶段进度条，点击节点可查看历史表单快照 (Read-Only Formily)。
    *   **多维视图**: 补充 `Finance` (成本) 和 `Team` (人力) 视图，实现全维度管理。
    *   **附件聚合**: 自动汇总各流程节点上传的文件，并在“附件柜”中统一展示。

---

## 🎨 3. UI/UX 规范摘要

### 色彩系统 (基于 Ant Design)
*   **Primary**: `#1890ff` (科技蓝) - 用于主按钮、链接、激活状态。
*   **Success**: `#52c41a` (草绿) - 用于“通过”、“完成”、“效率提升”。
*   **Warning**: `#faad14` (金黄) - 用于“退回”、“修改中”。
*   **Error**: `#ff4d4f` (警示红) - 用于“驳回”、“超时”、“紧急待办”。

### 交互细节
*   **表单只读态**: 使用 `ReadPretty` 模式，将输入框转换为纯文本，而不是禁用的灰色输入框，提升阅读体验。
*   **操作反馈**:
    *   成功 -> `message.success`
    *   失败 -> `message.error`
    *   危险操作 (如删除/驳回) -> `Modal.confirm` 二次确认。

---

## 🌟 5. 企业级特性增强规划 (Phase 2+)

### 5.1 实时性与交互反馈 (Real-time)
*   **全局通知中心**: 引入 WebSocket，实现流程状态变更的实时推送。
*   **全局命令面板 (Command Palette)**: 类似 `Ctrl+K` 调出的搜索框，支持快速跳转项目、查找文件。

### 5.2 数据可视化 (Data BI)
*   **场景**: 在工作台引入 ECharts/AntV。
*   **图表**: 项目漏斗图、人员负荷雷达图。

### 5.3 🛡️ 企业级安全 (Security) - 优先落实
*   **动态水印 (Watermark)**:
    *   **方案**: 使用 Ant Design 5 原生 `<Watermark>` 组件包裹 `MainLayout` 内容区。
    *   **内容**: 显示 "当前用户姓名 + 手机后4位"。
    *   **价值**: 极低成本实现防拍照泄密。

### 5.4 移动端适配 (Mobile)
*   **策略**: PC 端优先。
*   **响应式表单规范**: 预留“表单响应式策略”。在 Schema 设计层，所有 `FormGrid` 布局必须定义 `maxColumns` 和 `minColumns`。
    *   PC 端: 2-3 列布局。
    *   Mobile 端: 强制 1 列 (Stack Layout)，输入框与Label垂直排列。

### 5.5 文档与协作 (Collaboration)
*   **在线预览**: 在附件柜中集成 PDF/Office 在线预览，减少下载操作。
*   **意见模板**: 审批时提供“常用语”快捷选择。

---

## � 6. 关键技术协议 (Protocol Specs)

### 6.1 动态表单加载协议
前端 `services/schema.ts` 需实现以下标准加载流：

1.  **Request**: `GET /api/v1/tasks/{taskId}/form`
2.  **Response**:
    ```json
    {
      "schema": { ... },       // Formily JSON Schema (已包含 x-pattern: readPretty 等后端计算结果)
      "formData": { ... },     // 业务数据
      "permissions": {         // (可选) 额外的按钮级权限
         "canReject": true,
         "canDelegate": false
      }
    }
    ```
3.  **Frontend Action**:
    *   `FormilyRenderer` 接收 Schema 直接渲染。
    *   根据 `permissions` 字段动态显示/隐藏底部的“驳回”、“委派”按钮。
