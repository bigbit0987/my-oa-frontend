# ADR-001 前后端分离开发策略

## 状态

已采纳

## 背景

在当前的 OA 系统开发过程中，面临以下现状：

1. 后端提供了 `api-docs.json` (OpenAPI/Swagger)，但仅覆盖了部分模块（用户、认证、工作流、权限等）。
2. 核心业务模块（如 Project 项目管理）在 API 文档中尚未定义。
3. 后端服务目前尚未返回实际业务数据，部分接口可能仅返回空数据或尚未实现。
4. 前端需要持续推进开发，不能被后端进度阻塞。

## 决策

我们决定采取 **"契约驱动 + 模拟数据" (Contract-First & Mocking Strategy)** 的混合开发模式：

### 1. 已定义模块：严格遵循契约 (Contract-First)

对于 `api-docs.json` 中已存在的模块（User, Auth, Workflow, Department 等）：

- **准则**：严格遵守后端提供的 Schema 定义。
- **执行**：
  - 根据 `api-docs.json` 生成 TypeScript 类型定义 (`src/types/api.d.ts`)。
  - 在 `src/mocks` 中创建符合这些 Schema 结构的 Mock 数据。
  - 确保前端组件绑定的字段名与 API 文档完全一致。

### 2. 未定义模块：前端驱动设计 (Frontend-Driven Design)

对于文档中缺失的模块（主要为 Project 项目管理）：

- **准则**：前端先行定义数据结构，作为事实上的标准。
- **执行**：
  - 在前端代码 (`src/services/*.ts`) 中设计并完善 TypeScript 接口定义。
  - 以此接口为基础开发 UI 和业务逻辑。
  - **关键动作**：将前端定义的接口结构（`.ts` 文件或文档）同步给后端团队，要求后端在实现时参考前端的数据结构，反向推动接口契约的达成。

### 3. 工程实现：双模切换

保留并完善现有的 Mock 开关机制：

- 使用环境变量 `VITE_USE_MOCK` 控制数据源切换。
- `src/services` 层负责根据开关决定是请求 `src/mocks/*.json` 还是真实后端接口。
- 这种设计允许前端在无网络、无后端的情况下进行全功能演示和开发。

## 实施行动项 (Action Items)

### 1. 完善 TypeScript 类型定义

- **目标**：建立统一的类型定义文件 `src/types/api.d.ts`。
- **来源**：解析 `api-docs.json` 中的 `components/schemas` 部分，自动或手动转换为 TypeScript 接口。
- **收益**：
  - 代码编写时获得 IDE 智能提示。
  - 编译期检查字段名和类型匹配，减少运行时错误。
  - 作为前后端沟通的共享语言。

### 2. 统一 Mock 策略

- **现状**：Mock 逻辑散落在各个 `src/services/*.ts` 文件中，通过 `if (USE_LOCAL_MOCK)` 分支实现。
- **评估与选择**：
  | 方案 | 适用场景 | 优点 | 缺点 |
  |------|----------|------|------|
  | **现有方案（保持）** | 小规模项目，接口数量有限 | 简单直接，无额外依赖 | 逻辑分散，维护成本随接口增加而上升 |
  | **MSW (Mock Service Worker)** | 中大型项目，需要拦截网络请求 | 请求级别拦截，与真实 API 行为一致；可用于测试 | 需引入新依赖，配置成本 |
- **当前决定**：鉴于项目当前规模，暂**保持现有方案**。但需遵守以下纪律：
  - 所有 Mock 数据必须存放于 `src/mocks/` 目录，不得硬编码在 service 文件中。
  - Mock 数据的字段结构必须与 `src/types/api.d.ts` 或对应 service 的 Interface 定义保持严格一致。
  - 后续若接口数量显著增加（>20 个），应重新评估是否引入 MSW。

## 后果 (Consequences)

### 正面影响

- **解耦开发**：前端进度完全不再依赖后端的具体实现进度。
- **降低风险**：对于已定义的接口，提前发现 Schema 问题；对于未定义的接口，通过前端先行并在后期同步，减少联调时的字段不匹配。
- **演示能力**：随时具备离线演示完整功能的能力（Demo Ready）。

### 负面影响/成本

- **Mock 维护成本**：需要人工维护 `src/mocks` 下的 JSON 数据，且需确保其与其 TypeScript 类型定义保持一致。
- **沟通成本**：对于"未定义模块"，必须主动向后端同步前端定义的结构，否则后期联调会出现大规模重构。

## 相关文件

- `api-docs.json`: 后端提供的接口契约。
- `src/services/project.ts`: 前端定义的项目模块接口（即事实标准）。
- `src/mocks/`: 本地模拟数据存放目录。
