# ADR-006: 前端技术架构与设计规范

**状态**: ✅ 已实施  
**日期**: 2024-12-24  
**决策者**: 架构小组  
**相关文档**: 
- [07_前端系统架构与开发实施指南.md](../07_前端系统架构与开发实施指南.md)
- [TODO-前端重构实施计划.md](../TODO-前端重构实施计划.md)

---

## 📋 背景与问题

随着 OA 系统后端核心功能（流程引擎、权限控制、数据继承）的日益完善，目前的前端实现（仅作为简单的 API 调试界面）已无法满足“企业级交付”的体验要求。用户界面缺乏系统性设计，交互体验简陋，无法发挥后端的强大能力。

我们需要构建一套**现代化、高性能、高颜值**的企业级前端系统。

在技术选型上，我们面临的主要挑战是：如何整合目前行业内最优秀的几个库，同时避免它们之间的潜在冲突（特别是全家桶脚手架带来的“重”与 Vite 带来的“快”之间的矛盾）。

---

## 🛠️ 技术选型决策

### 1. 核心框架栈 (The "Vite-React" Core)
*   **构建工具**: **Vite** (放弃 UmiJS 脚手架)
    *   *理由*: 极速的冷启动和热更新体验，生态标准兼容性更好。
*   **视图库**: **React 18**
*   **语言**: **TypeScript 5.x**
*   **路由**: **React Router v6**
*   **状态管理**: **Zustand**
    *   *理由*: 相比 Redux/Dva，Zustand 更轻量、原子化，且无样板代码，非常适合中后台复杂的局部状态管理。

### 2. UI 组件体系 (The "Pro-Atom" Strategy)
我们采用 **"Ant Design Pro Components + Formily"** 的混合策略。

*   **基础 UI**: **Ant Design 5.0** (使用 Design Token 系统)
*   **高级布局与列表**: **@ant-design/pro-components**
    *   `ProLayout`: 快速搭建侧边栏、顶部导航、面包屑。
    *   `ProTable`: 处理复杂的查询列表、筛选、工具栏。
    *   `ProCard`: 构建仪表盘卡片和分栏布局。
    *   *决策*: **不引入 Ant Design Pro 全套脚手架**，仅按需安装组件包，避免与 Vite 产生构建冲突。
*   **动态表单引擎**: **Formily 2.x**
    *   *理由*: OA 系统的核心是流转的表单。Formily 提供的 Schema 驱动、前后端协议联调、复杂联动逻辑能力远超 ProForm。
    *   *适用边界*: 核心业务流转表单使用 Formily；简单的查询过滤、模态框表单可使用 ProForm。

### 3. CSS 方案
*   **Tailwind CSS v4**
    *   *理由*: 用于微调布局、边距、字体颜色，替代传统的 CSS Modules 写法，极大提升开发效率。
    *   *配置要点*: 使用 `@tailwindcss/postcss` 插件，CSS 中使用 `@import "tailwindcss"`。

---

## 🎨 设计规范 (Design System)

### 1. 视觉风格： "Modern Enterprise"
*   **关键词**: 专业、克制、轻盈、科技感。
*   **主色调**: Ant Design 默认的科技蓝 (Daybreak Blue) `#1890ff`。
*   **布局风格**: **Bento Grid (便当盒布局)**
    *   Dashboard 采用卡片式拼贴，强调信息的高密度与条理性。
    *   利用投影和圆角区分层级，而非沉重的边框。
*   **质感**: 适度使用 **Glassmorphism (毛玻璃)** 效果于顶部统计卡片，提升高级感。

### 2. 交互原则
*   **Loading 策略**: 全局路由切换使用 NProgress，局部卡片加载使用 Skeleton（骨架屏），杜绝全屏白屏。
*   **错误处理**: 所有 API 请求异常通过全局拦截器处理，统一弹出 Toast 或 ErrorBoundary 页面。

---

## 🗺️ 模块架构规划

系统划分为四大核心功能域：

1.  **工作台 (Dashboard)**: 用户的"早晨第一站"，聚合待办与指标。
2.  **流程中心 (Process Center)**: 任务办理流水线，核心 Formily 容器所在。
3.  **项目中心 (Project Center)**: 以"项目"为维度的数据聚合视图，包含 Timeline 和数据大屏。
4.  **系统管理 (Admin)**: 权限与规则配置。

---

## ⚠️ 风险与对策

| 风险点 | 说明 | 对策 | 实施结果 |
|-------|------|------|---------|
| **Formily vs ProForm** | 两者功能重叠 | 严格划分边界：**业务表单用 Formily**，**页面级筛选/轻表单用 ProForm**。 | ✅ 已实施 |
| **Vite vs AntD 样式** |按需加载配置复杂 | 使用 AntD 5 的 CSS-in-JS 特性，无需配置 babel-plugin-import。 | ✅ 无冲突 |
| **样式污染** | Tailwind 可能重置 AntD 样式 | 使用 `@tailwindcss/postcss`，无需禁用 preflight。 | ✅ 已验证 |

---

## ✅ 实施结果 (2024-12-24)

| 阶段 | 成果 |
|------|------|
| **Phase 1** | MainLayout + WatermarkWrapper + Tailwind CSS v4 配置 |
| **Phase 2** | Bento Grid Dashboard (KPI + 待办 + 快捷入口 + 项目进度) |
| **Phase 3** | 三段式 TaskHandle (Formily + Timeline + 吸底操作栏) |
| **Phase 4** | ProTable 项目台账 + 详情大屏 (Sticky Header + Tabs) |

详见 [TODO-前端重构实施计划.md](../TODO-前端重构实施计划.md)
