# ADR-006: 前端技术架构与设计规范

**状态**: ✅ 已实施  
**日期**: 2024-12-24  
**决策者**: 架构小组  
**相关文档**: 
- [07_前端系统架构与开发实施指南.md](../07_前端系统架构与开发实施指南.md)
- [TODO-前端重构实施计划.md](../TODO-前端重构实施计划.md)

---

## 📋 背景与问题

随着 OA 系统后端核心功能（流程引擎、权限控制、数据继承）的日益完善，目前的前端实现（仅作为简单的 API 调试界面）已无法满足“企业级交付”的体验要求。用户界面缺乏系统性设计，交互体验简陋，无法发挥后端的强大能力。

我们需要构建一套**现代化、高性能、高颜值**的企业级前端系统。

在技术选型上，我们面临的主要挑战是：如何整合目前行业内最优秀的几个库，同时避免它们之间的潜在冲突（特别是 React 19 新特性与 Formily/ProComponents 现有生态的稳定性差异）。

---

## 🛠️ 技术选型决策 (Updated 2025-12-24)

### 1. 核心框架栈 (The "Stable Core" Strategy)
> **决策变更**: 原计划使用 React 最新版，现调整为 **"保守核心 + 激进工具"** 策略。

*   **构建工具**: **Vite 7.x**
    *   *理由*: 享受最新的构建速度和热更新体验 (HMR)。
*   **视图库**: **React 18.3.1** (锁定版本)
    *   *理由*: 避免 React 19 的 Ref 变更和并发渲染特性导致 `Formily 2.x` 和 `@ant-design/pro-components` 出现不稳定 Bug。
*   **路由**: **React Router v6.28.0**
    *   *理由*: 保持 API 稳定，符合现有生态最佳实践。
*   **状态管理**: **Zustand**
    *   *理由*: 轻量、原子化，适合管理复杂的局部状态。

### 2. UI 组件体系 (The "Pro-Atom" Strategy)
我们采用 **"Ant Design Pro Components + Formily"** 的混合策略。

*   **基础 UI**: **Ant Design 5.x** (使用 Design Token 系统)
*   **高级布局与列表**: **@ant-design/pro-components**
    *   `ProLayout`: 侧边栏框架。
    *   `ProTable`: 复杂查询表格。
*   **动态表单引擎**: **Formily 2.x**
    *   *适用边界*: 核心业务流转表单使用 Formily；简单的查询过滤使用 ProForm。

### 3. CSS 方案
*   **Tailwind CSS v4.0**
    *   *理由*: 使用最新的 Oxide 引擎，零配置 (`@import "tailwindcss"`)，极大简化开发。
    *   *配置要点*: 必须通过 PostCSS 插件集成，并配置 Theme Token 桥接 AntD 变量。

---

## 🎨 设计规范 (Design System)

### 1. 视觉风格： "Modern Enterprise"
*   **主色调**: Ant Design 默认的科技蓝 (Daybreak Blue) `#1890ff`。
*   **布局风格**: **Bento Grid (便当盒布局)**
    *   Dashboard 采用卡片式拼贴，强调信息的高密度与条理性。

### 2. 企业级鲁棒性设计
*   **样式同步 (Token Bridge)**: 
    *   通过 CSS 变量 (`var(--color-primary)`) 强制同步 AntD Token 与 Tailwind Utility。
*   **协议仿真 (Schema Mocking)**: 
    *   在 `services/schema.ts` 实现本地 Mock 回退机制，支持前后端并行开发。

---

## ⚠️ 风险与对策

| 风险点 | 说明 | 对策 | 状态 |
|-------|------|------|---------|
| **React 19 兼容性** | Formily 在 React 19 下可能报错 | **降级至 React 18.3.1**，锁定依赖版本。 | 🔒 已锁定 |
| **Vite vs AntD 样式** | 按需加载配置复杂 | 使用 AntD 5 CSS-in-JS + Tailwind v4 PostCSS，无冲突。 | ✅ 已验证 |
| **样式污染** | Tailwind 重置 AntD 样式 | Tailwind v4 默认 Layer 机制更好，无需禁用 Preflight。 | ✅ 已验证 |

---

## ✅ 实施路线图

详细的 16 周实施计划请参考独立文档：
👉 **[OA前端系统重构实施计划 (Roadmap)](../TODO-前端重构实施计划.md)**

1.  **Phase 1**: 基础设施与安全底座 (Current Focus)
2.  **Phase 2**: 工作台与数据仿真
3.  **Phase 3**: 流程中心
4.  **Phase 4**: 项目中心
