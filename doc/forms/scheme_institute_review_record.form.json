{
  "form": {
    "layout": "horizontal",
    "labelCol": 6,
    "wrapperCol": 12,
    "labelAlign": "left",
    "style": {
      "margin": "0px 0px 0px 0px",
      "borderRadius": "0px 0px 0px 0px",
      "padding": "10px 24px 10px 24px",
      "backgroundColor": "",
      "height": "inherit",
      "width": "inherit"
    },
    "colon": false
  },
  "schema": {
    "type": "object",
    "properties": {
      "tableLayout": {
        "type": "void",
        "x-component": "FormLayout",
        "x-component-props": {
          "wrapperAlign": null,
          "style": {
            "borderRadius": "6px 6px 6px 6px",
            "boxShadow": "2px 1px 5px 4px rgba(0, 0, 0, 0.1)",
            "padding": "5px 5px 5px 5px",
            "margin": "0px 0px 0px 0px"
          },
          "feedbackLayout": "loose"
        },
        "name": "tableLayout",
        "properties": {
          "tableHeader": {
            "type": "string",
            "x-component": "Text",
            "x-component-props": {
              "content": "规划所管理记录表",
              "mode": "h1",
              "style": {
                "display": "block",
                "backgroundColor": "",
                "fontFamily": "arial black,sans-serif",
                "margin": "10px 0px 0px 0px",
                "padding": "10px 0px 0px 0px",
                "borderRadius": "0px 0px 0px 0px",
                "textAlign": "center"
              }
            },
            "name": "tableHeader",
            "x-index": 0
          },
          "applicantInfoGrid": {
            "type": "void",
            "x-component": "FormGrid",
            "x-component-props": {
              "maxColumns": 3,
              "style": {
                "margin": "10px 0"
              }
            },
            "name": "applicantInfoGrid",
            "x-designable-id": "applicant_info_grid",
            "x-index": 1,
            "properties": {
              "applicantId": {
                "type": "string",
                "title": "申请人",
                "x-decorator": "FormItem",
                "x-component": "Select",
                "x-dynamic-data": {
                  "type": "user"
                },
                "x-component-props": {
                  "placeholder": "请选择申请人",
                  "showSearch": true
                },
                "name": "applicantId",
                "x-designable-id": "applicant_id_field",
                "x-index": 0
              },
              "deptId": {
                "type": "string",
                "title": "所属部门",
                "x-decorator": "FormItem",
                "x-component": "Select",
                "x-dynamic-data": {
                  "type": "dept"
                },
                "x-component-props": {
                  "placeholder": "请选择部门",
                  "showSearch": true
                },
                "name": "deptId",
                "x-designable-id": "dept_id_field",
                "x-index": 1
              },
              "applyTime": {
                "type": "string",
                "title": "申请时间",
                "x-decorator": "FormItem",
                "x-component": "DatePicker",
                "x-component-props": {
                  "readOnly": true
                },
                "name": "applyTime",
                "x-designable-id": "apply_time_field",
                "x-index": 2
              }
            }
          },
          "basicInfoSection": {
            "type": "void",
            "x-component": "Card",
            "x-component-props": {
              "title": "项目基本信息",
              "size": "small",
              "styles": {
                "header": {
                  "paddingTop": "0px",
                  "paddingBottom": "0px",
                  "minHeight": "auto",
                  "textAlign": "center",
                  "backgroundColor": "rgb(200, 221, 252)",
                  "fontSize": "16px"
                }
              },
              "style": {
                "margin": "10px 0px 0px 0px"
              }
            },
            "name": "basicInfoSection",
            "x-index": 2,
            "properties": {
              "basicInfoGrid": {
                "type": "void",
                "x-component": "FormGrid",
                "x-component-props": {
                  "maxColumns": 3,
                  "columnGap": 10,
                  "rowGap": 0
                },
                "name": "basicInfoGrid",
                "x-index": 0,
                "properties": {
                  "projectId": {
                    "type": "string",
                    "title": "审查项目",
                    "x-decorator": "FormItem",
                    "x-decorator-props": {
                      "gridSpan": 3
                    },
                    "x-component": "Select",
                    "x-dynamic-data": {
                      "type": "project"
                    },
                    "x-component-props": {
                      "placeholder": "请选择项目",
                      "showSearch": true,
                      "filterOption": true,
                      "optionFilterProp": "label"
                    },
                    "x-validator": [
                      {
                        "required": true,
                        "message": "请选择项目"
                      }
                    ],
                    "name": "projectId",
                    "x-index": 0,
                    "x-reactions": [
                      {
                        "dependencies": [],
                        "fulfill": {
                          "run": "\n                            if (!$self.value) return;\n                            const projectId = $self.value;\n                            $form.$http.get('/api/v1/forms/data/project/' + projectId)\n                              .then(res => {\n                                const data = res.data || {};\n                                $form.setFieldState('projectNumber', state => { state.value = data.projectNumber || ''; });\n                                $form.setFieldState('projectManagerId', state => { state.value = data.projectManagerId ? String(data.projectManagerId) : ''; });\n                                $form.setFieldState('responsibleDeptId', state => { state.value = data.responsibleDeptId ? String(data.responsibleDeptId) : ''; });\n                                $form.setFieldState('projectLevelKey', state => { state.value = data.projectLevelKey || ''; });\n                                $form.setFieldState('controlLevelKey', state => { state.value = data.controlLevelKey || ''; });\n                                $form.setFieldState('importanceKey', state => { state.value = data.importanceKey || ''; });\n                                $form.setFieldState('projectAuditorId', state => { state.value = data.projectAuditorId ? String(data.projectAuditorId) : ''; });\n\n                                // 加载角色信息 (架构师方案：中心化角色引用)\n                                $form.$http.get('/api/v1/projects/' + projectId + '/team-members')\n                                  .then(memberRes => {\n                                    const members = memberRes.data || {};\n                                    const planProof = members.PLAN_PROOFREADER || {};\n                                    const engProof = members.ENG_PROOFREADER || {};\n                                    const recorder = members.RECORDER || {};\n\n                                    $form.setFieldState('planProofreaderId', state => {\n                                      state.value = planProof.id ? String(planProof.id) : '';\n                                      if (planProof.id && !planProof.active) {\n                                        state.description = '<span style=\"color:red;font-weight:bold\">原校对人已离职/停用，请重新指定！</span>';\n                                      } else {\n                                        state.description = '';\n                                      }\n                                    });\n\n                                    $form.setFieldState('engProofreaderId', state => {\n                                      state.value = engProof.id ? String(engProof.id) : '';\n                                      if (engProof.id && !engProof.active) {\n                                        state.description = '<span style=\"color:red;font-weight:bold\">原校对人已离职/停用，请重新指定！</span>';\n                                      } else {\n                                        state.description = '';\n                                      }\n                                    });\n\n                                    $form.setFieldState('recorderId', state => {\n                                      state.value = recorder.id ? String(recorder.id) : '';\n                                      if (recorder.id && !recorder.active) {\n                                        state.description = '<span style=\"color:red;font-weight:bold\">原记录人已离职/停用，请重新指定！</span>';\n                                      } else {\n                                        state.description = '';\n                                      }\n                                    });\n                                  });\n                              })\n                              .catch(err => { console.error('加载项目详情失败:', err); });\n                          "
                        }
                      }
                    ]
                  },
                  "projectNumber": {
                    "type": "string",
                    "title": "项目编号",
                    "x-decorator": "FormItem",
                    "x-component": "Input",
                    "x-pattern": "readPretty",
                    "name": "projectNumber",
                    "x-index": 1
                  },
                  "projectManagerId": {
                    "type": "string",
                    "title": "项目负责人",
                    "x-decorator": "FormItem",
                    "x-component": "Select",
                    "x-dynamic-data": {
                      "type": "user"
                    },
                    "x-pattern": "readPretty",
                    "name": "projectManagerId",
                    "x-index": 2
                  },
                  "responsibleDeptId": {
                    "type": "string",
                    "title": "承担部门",
                    "x-decorator": "FormItem",
                    "x-component": "Select",
                    "x-dynamic-data": {
                      "type": "dept"
                    },
                    "x-pattern": "readPretty",
                    "name": "responsibleDeptId",
                    "x-index": 3
                  },
                  "projectLevelKey": {
                    "type": "string",
                    "title": "项目分级",
                    "x-decorator": "FormItem",
                    "x-component": "Select",
                    "x-dynamic-data": {
                      "type": "dict",
                      "dictKey": "project_level"
                    },
                    "x-pattern": "readPretty",
                    "name": "projectLevelKey",
                    "x-index": 4
                  },
                  "projectAuditorId": {
                    "type": "string",
                    "title": "项目审核",
                    "x-decorator": "FormItem",
                    "x-component": "Select",
                    "x-dynamic-data": {
                      "type": "user"
                    },
                    "x-pattern": "readPretty",
                    "name": "projectAuditorId",
                    "x-index": 5
                  },
                  "reviewCount": {
                    "type": "number",
                    "title": "已所审次数",
                    "x-decorator": "FormItem",
                    "x-component": "NumberPicker",
                    "name": "reviewCount",
                    "x-index": 6
                  },
                  "importanceKey": {
                    "type": "string",
                    "title": "重要程度",
                    "x-decorator": "FormItem",
                    "x-component": "Select",
                    "x-dynamic-data": {
                      "type": "dict",
                      "dictKey": "importance_level"
                    },
                    "x-pattern": "readPretty",
                    "name": "importanceKey",
                    "x-index": 7
                  },
                  "controlLevelKey": {
                    "type": "string",
                    "title": "流程管控强度",
                    "x-decorator": "FormItem",
                    "x-component": "Select",
                    "x-dynamic-data": {
                      "type": "dict",
                      "dictKey": "control_level"
                    },
                    "x-pattern": "readPretty",
                    "name": "controlLevelKey",
                    "x-index": 8
                  },
                  "finishTime": {
                    "type": "string",
                    "title": "完成时间",
                    "x-decorator": "FormItem",
                    "x-component": "DatePicker",
                    "x-component-props": {
                      "format": "YYYY-MM-DD HH:mm"
                    },
                    "name": "finishTime",
                    "x-index": 9
                  }
                }
              }
            }
          },
          "instituteReviewJudgment": {
            "type": "void",
            "x-component": "Card",
            "x-component-props": {
              "title": "所审流程所内自主判断",
              "size": "small",
              "styles": {
                "header": {
                  "paddingTop": "0px",
                  "paddingBottom": "0px",
                  "minHeight": "auto",
                  "textAlign": "center",
                  "backgroundColor": "rgb(200, 221, 252)",
                  "fontSize": "16px"
                }
              }
            },
            "name": "instituteReviewJudgment",
            "x-index": 3,
            "properties": {
              "isSkipInstitute": {
                "type": "string",
                "title": "是否跳过所审",
                "x-decorator": "FormItem",
                "x-component": "Radio.Group",
                "x-component-props": {
                  "options": [
                    {
                      "label": "是",
                      "value": "yes"
                    },
                    {
                      "label": "否",
                      "value": "no"
                    }
                  ]
                },
                "x-decorator-props": {
                  "tooltip": "说明：仅适用于V类流程",
                  "description": "<span style='color:red'>说明：仅适用于V类流程</span>"
                },
                "name": "isSkipInstitute",
                "x-index": 0
              },
              "skipInstituteReason": {
                "type": "string",
                "title": "跳过原因",
                "x-decorator": "FormItem",
                "x-component": "Input.TextArea",
                "name": "skipInstituteReason",
                "x-index": 1,
                "x-reactions": {
                  "dependencies": [
                    "isSkipInstitute"
                  ],
                  "fulfill": {
                    "state": {
                      "visible": "{{$deps[0] === 'yes'}}"
                    }
                  }
                }
              },
              "instituteLeaderId": {
                "type": "string",
                "title": "领导审批",
                "x-decorator": "FormItem",
                "x-component": "Select",
                "x-dynamic-data": {
                  "type": "user"
                },
                "x-decorator-props": {
                  "description": "<span style='color:red'>说明：填写跳过原因与领导审批不能为同一人！（当所领导同时为项目负责人时，需特别注意）</span>"
                },
                "name": "instituteLeaderId",
                "x-index": 2,
                "x-reactions": {
                  "dependencies": [
                    "isSkipInstitute"
                  ],
                  "fulfill": {
                    "state": {
                      "visible": "{{$deps[0] === 'yes'}}"
                    }
                  }
                }
              }
            }
          },
          "academyReviewJudgment": {
            "type": "void",
            "x-component": "Card",
            "x-component-props": {
              "title": "院审流程所内自主判断",
              "size": "small",
              "styles": {
                "header": {
                  "paddingTop": "0px",
                  "paddingBottom": "0px",
                  "minHeight": "auto",
                  "textAlign": "center",
                  "backgroundColor": "rgb(200, 221, 252)",
                  "fontSize": "16px"
                }
              }
            },
            "name": "academyReviewJudgment",
            "x-index": 4,
            "properties": {
              "isSkipAcademy": {
                "type": "string",
                "title": "是否跳过院审",
                "x-decorator": "FormItem",
                "x-component": "Radio.Group",
                "x-component-props": {
                  "options": [
                    {
                      "label": "是",
                      "value": "yes"
                    },
                    {
                      "label": "否",
                      "value": "no"
                    }
                  ]
                },
                "x-decorator-props": {
                  "description": "<span style='color:red'>说明：仅适用于III类流程；IV、V类流程直接跳过院审阶段</span>"
                },
                "name": "isSkipAcademy",
                "x-index": 0
              },
              "skipAcademyReason": {
                "type": "string",
                "title": "跳过原因",
                "x-decorator": "FormItem",
                "x-component": "Input.TextArea",
                "name": "skipAcademyReason",
                "x-index": 1,
                "x-reactions": {
                  "dependencies": [
                    "isSkipAcademy"
                  ],
                  "fulfill": {
                    "state": {
                      "visible": "{{$deps[0] === 'yes'}}"
                    }
                  }
                }
              },
              "academyLeaderId": {
                "type": "string",
                "title": "领导审批",
                "x-decorator": "FormItem",
                "x-component": "Select",
                "x-dynamic-data": {
                  "type": "user"
                },
                "name": "academyLeaderId",
                "x-index": 2,
                "x-reactions": {
                  "dependencies": [
                    "isSkipAcademy"
                  ],
                  "fulfill": {
                    "state": {
                      "visible": "{{$deps[0] === 'yes'}}"
                    }
                  }
                }
              }
            }
          },
          "personnelSection": {
            "type": "void",
            "x-component": "Card",
            "x-component-props": {
              "title": "人员确定",
              "size": "small",
              "styles": {
                "header": {
                  "paddingTop": "0px",
                  "paddingBottom": "0px",
                  "minHeight": "auto",
                  "textAlign": "center",
                  "backgroundColor": "rgb(200, 221, 252)",
                  "fontSize": "16px"
                }
              }
            },
            "name": "personnelSection",
            "x-index": 5,
            "properties": {
              "personnelGrid": {
                "type": "void",
                "x-component": "FormGrid",
                "x-component-props": {
                  "maxColumns": 3,
                  "columnGap": 10
                },
                "name": "personnelGrid",
                "x-index": 0,
                "properties": {
                  "hostId": {
                    "type": "string",
                    "title": "主持人",
                    "x-decorator": "FormItem",
                    "x-component": "Select",
                    "x-dynamic-data": {
                      "type": "user"
                    },
                    "name": "hostId",
                    "x-index": 0
                  },
                  "planProofreaderId": {
                    "type": "string",
                    "title": "规划校对",
                    "x-decorator": "FormItem",
                    "x-component": "Select",
                    "x-dynamic-data": {
                      "type": "user"
                    },
                    "name": "planProofreaderId",
                    "x-index": 1
                  },
                  "engProofreaderId": {
                    "type": "string",
                    "title": "工程校对",
                    "x-decorator": "FormItem",
                    "x-component": "Select",
                    "x-dynamic-data": {
                      "type": "user"
                    },
                    "name": "engProofreaderId",
                    "x-index": 2
                  },
                  "recorderId": {
                    "type": "string",
                    "title": "记录人",
                    "x-decorator": "FormItem",
                    "x-component": "Select",
                    "x-dynamic-data": {
                      "type": "user"
                    },
                    "name": "recorderId",
                    "x-index": 3
                  },
                  "otherId": {
                    "type": "string",
                    "title": "其它",
                    "x-decorator": "FormItem",
                    "x-component": "Input",
                    "name": "otherId",
                    "x-index": 4
                  },
                  "reviewDate": {
                    "type": "string",
                    "title": "所审日期",
                    "x-decorator": "FormItem",
                    "x-component": "DatePicker",
                    "name": "reviewDate",
                    "x-index": 5
                  }
                }
              },
              "attachmentSection": {
                "type": "void",
                "x-component": "FormGrid",
                "x-component-props": {
                  "maxColumns": 4
                },
                "name": "attachmentSection",
                "properties": {
                  "hasAttachment": {
                    "type": "string",
                    "title": "附件上传(归档)",
                    "x-decorator": "FormItem",
                    "x-component": "Radio.Group",
                    "x-component-props": {
                      "options": [
                        {
                          "label": "有",
                          "value": "yes"
                        },
                        {
                          "label": "无",
                          "value": "no"
                        }
                      ]
                    },
                    "name": "hasAttachment",
                    "x-index": 0
                  },
                  "attachmentFile": {
                    "type": "array",
                    "x-decorator": "FormItem",
                    "x-decorator-props": {
                      "gridSpan": 3,
                      "labelCol": null,
                      "wrapperCol": 24
                    },
                    "x-component": "Upload",
                    "x-component-props": {
                      "textContent": "点击上传附件"
                    },
                    "name": "attachmentFile",
                    "x-index": 1,
                    "x-reactions": {
                      "dependencies": [
                        "hasAttachment"
                      ],
                      "fulfill": {
                        "state": {
                          "visible": "{{$deps[0] === 'yes'}}"
                        }
                      }
                    }
                  }
                }
              },
              "proofreadTip": {
                "type": "void",
                "x-component": "Text",
                "x-component-props": {
                  "content": "说明：若只有一名校对，选定后在任意位置单击鼠标左键，即可取消另一校对的必填。",
                  "style": {
                    "color": "red",
                    "fontSize": "12px",
                    "paddingLeft": "24px"
                  }
                },
                "name": "proofreadTip"
              }
            }
          },
          "reviewRecordSection": {
            "type": "void",
            "x-component": "Card",
            "x-component-props": {
              "title": "所审记录",
              "size": "small",
              "styles": {
                "header": {
                  "paddingTop": "0px",
                  "paddingBottom": "0px",
                  "minHeight": "auto",
                  "textAlign": "center",
                  "backgroundColor": "rgb(200, 221, 252)",
                  "fontSize": "16px"
                }
              }
            },
            "name": "reviewRecordSection",
            "x-index": 6,
            "properties": {
              "reviewRecords": {
                "type": "array",
                "x-decorator": "FormItem",
                "x-component": "ArrayTable",
                "x-component-props": {
                  "bordered": true,
                  "pagination": false
                },
                "name": "reviewRecords",
                "items": {
                  "type": "object",
                  "properties": {
                    "indexColumn": {
                      "type": "void",
                      "x-component": "ArrayTable.Column",
                      "x-component-props": {
                        "title": "序号",
                        "width": 60,
                        "align": "center"
                      },
                      "properties": {
                        "index": {
                          "type": "void",
                          "x-component": "ArrayTable.Index"
                        }
                      }
                    },
                    "opinionDetail": {
                      "type": "void",
                      "x-component": "ArrayTable.Column",
                      "x-component-props": {
                        "title": "意见详情"
                      },
                      "properties": {
                        "opinion": {
                          "type": "string",
                          "x-component": "Input.TextArea",
                          "name": "opinion"
                        }
                      }
                    },
                    "opinionType": {
                      "type": "void",
                      "x-component": "ArrayTable.Column",
                      "x-component-props": {
                        "title": "意见类型",
                        "width": 150
                      },
                      "properties": {
                        "type": {
                          "type": "string",
                          "x-component": "Select",
                          "x-dynamic-data": {
                            "type": "dict",
                            "dictKey": "opinion_type"
                          }
                        }
                      }
                    },
                    "operation": {
                      "type": "void",
                      "x-component": "ArrayTable.Column",
                      "x-component-props": {
                        "title": "操作",
                        "width": 60,
                        "align": "center"
                      },
                      "properties": {
                        "remove": {
                          "type": "void",
                          "x-component": "ArrayTable.Remove"
                        }
                      }
                    }
                  }
                },
                "properties": {
                  "add": {
                    "type": "void",
                    "x-component": "ArrayTable.Addition",
                    "x-component-props": {
                      "title": "添加意见"
                    }
                  }
                }
              }
            }
          },
          "verificationSection": {
            "type": "void",
            "x-component": "Card",
            "x-component-props": {
              "title": "主持人验证",
              "size": "small",
              "styles": {
                "header": {
                  "paddingTop": "0px",
                  "paddingBottom": "0px",
                  "minHeight": "auto",
                  "textAlign": "center",
                  "backgroundColor": "rgb(200, 221, 252)",
                  "fontSize": "16px"
                }
              }
            },
            "name": "verificationSection",
            "x-index": 7,
            "properties": {
              "verificationGrid": {
                "type": "void",
                "x-component": "FormGrid",
                "x-component-props": {
                  "maxColumns": 1
                },
                "name": "verificationGrid",
                "properties": {
                  "verificationResult": {
                    "type": "string",
                    "title": "验证记录",
                    "x-decorator": "FormItem",
                    "x-component": "Radio.Group",
                    "x-component-props": {
                      "options": [
                        {
                          "label": "是",
                          "value": "yes"
                        },
                        {
                          "label": "否",
                          "value": "no"
                        }
                      ]
                    },
                    "name": "verificationResult"
                  },
                  "verificationOpinion": {
                    "type": "string",
                    "title": "意见/签字",
                    "x-decorator": "FormItem",
                    "x-component": "Input.TextArea",
                    "x-component-props": {
                      "placeholder": "请输入意见或签字"
                    },
                    "name": "verificationOpinion"
                  },
                  "finalAgreement": {
                    "type": "string",
                    "title": "是否同意及处置意见",
                    "x-decorator": "FormItem",
                    "x-component": "Radio.Group",
                    "x-component-props": {
                      "options": [
                        {
                          "label": "是",
                          "value": "agree"
                        },
                        {
                          "label": "否",
                          "value": "disagree"
                        }
                      ]
                    },
                    "name": "finalAgreement"
                  }
                }
              },
              "footerNote": {
                "type": "void",
                "x-component": "Text",
                "x-component-props": {
                  "content": "注：方案所审意见由指定人员负责记录，所审主持人签字生效。验证原则上由原主持人签字，特殊情况可由负责人签字",
                  "style": {
                    "color": "#999",
                    "fontSize": "12px",
                    "marginTop": "10px",
                    "display": "block",
                    "textAlign": "center"
                  }
                },
                "name": "footerNote"
              }
            }
          }
        }
      }
    }
  }
}