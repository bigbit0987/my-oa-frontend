<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" xmlns:flowable="http://flowable.org/bpmn" targetNamespace="http://www.company.com/workflow" exporter="Camunda Modeler" exporterVersion="5.41.0">
  <process id="site_survey_record_process" name="项目现场踏勘流程" isExecutable="true">
    <startEvent id="startEvent" name="开始" flowable:initiator="initiator" />
    <sequenceFlow id="flow_start_to_pm" sourceRef="startEvent" targetRef="task_pm_submit" />
    <userTask id="task_pm_submit" name="项目负责人填写" flowable:assignee="${initiator}" flowable:formKey="site_survey_record">
      <documentation>
        项目负责人根据项目情况填写踏勘记录或申请跳过踏勘。
      </documentation>
    </userTask>
    <sequenceFlow id="flow_pm_to_gateway" sourceRef="task_pm_submit" targetRef="gateway_skip_check" />
    <exclusiveGateway id="gateway_skip_check" name="是否跳过踏勘?" />
    <sequenceFlow id="flow_skip_yes" name="是 (跳过)" sourceRef="gateway_skip_check" targetRef="task_admin_approve_skip">
      <conditionExpression xsi:type="tFormalExpression">${vars:getOrDefault('isSkipStage', 'no') == 'yes'}</conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="flow_skip_no" name="否 (正常踏勘)" sourceRef="gateway_skip_check" targetRef="task_admin_verify_record">
      <conditionExpression xsi:type="tFormalExpression">${vars:getOrDefault('isSkipStage', 'no') != 'yes'}</conditionExpression>
    </sequenceFlow>
    <userTask id="task_admin_approve_skip" name="部门管理员审批(跳过)" flowable:candidateGroups="DEPT_ADMIN" flowable:formKey="site_survey_record">
      <documentation>审核项目负责人提交的跳过踏勘申请及原因</documentation>
    </userTask>
    <sequenceFlow id="flow_admin_skip_to_end" sourceRef="task_admin_approve_skip" targetRef="endEvent" />
    <userTask id="task_admin_verify_record" name="部门管理员核实情况" flowable:candidateGroups="DEPT_ADMIN" flowable:formKey="site_survey_record">
      <documentation>核实项目负责人提交的现场踏勘详细记录</documentation>
    </userTask>
    <sequenceFlow id="flow_admin_verify_to_end" sourceRef="task_admin_verify_record" targetRef="endEvent" />
    <endEvent id="endEvent" name="结束" />
  </process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_site_survey">
    <bpmndi:BPMNPlane id="BPMNPlane_site_survey" bpmnElement="site_survey_record_process">
      <bpmndi:BPMNShape id="shape_startEvent" bpmnElement="startEvent">
        <omgdc:Bounds x="150" y="190" width="30" height="30" />
        <bpmndi:BPMNLabel>
          <omgdc:Bounds x="154" y="220" width="22" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="shape_task_pm_submit" bpmnElement="task_pm_submit">
        <omgdc:Bounds x="230" y="175" width="100" height="60" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="shape_gateway_skip_check" bpmnElement="gateway_skip_check" isMarkerVisible="true">
        <omgdc:Bounds x="380" y="185" width="40" height="40" />
        <bpmndi:BPMNLabel>
          <omgdc:Bounds x="364" y="232" width="73" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="shape_task_admin_approve_skip" bpmnElement="task_admin_approve_skip">
        <omgdc:Bounds x="500" y="80" width="100" height="60" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="shape_task_admin_verify_record" bpmnElement="task_admin_verify_record">
        <omgdc:Bounds x="500" y="280" width="100" height="60" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="shape_endEvent" bpmnElement="endEvent">
        <omgdc:Bounds x="700" y="190" width="28" height="28" />
        <bpmndi:BPMNLabel>
          <omgdc:Bounds x="703" y="218" width="22" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="edge_start_to_pm" bpmnElement="flow_start_to_pm">
        <omgdi:waypoint x="180" y="205" />
        <omgdi:waypoint x="230" y="205" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="edge_pm_to_gateway" bpmnElement="flow_pm_to_gateway">
        <omgdi:waypoint x="330" y="205" />
        <omgdi:waypoint x="380" y="205" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="edge_skip_yes" bpmnElement="flow_skip_yes">
        <omgdi:waypoint x="400" y="185" />
        <omgdi:waypoint x="400" y="110" />
        <omgdi:waypoint x="500" y="110" />
        <bpmndi:BPMNLabel>
          <omgdc:Bounds x="409" y="140" width="44" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="edge_skip_no" bpmnElement="flow_skip_no">
        <omgdi:waypoint x="400" y="225" />
        <omgdi:waypoint x="400" y="310" />
        <omgdi:waypoint x="500" y="310" />
        <bpmndi:BPMNLabel>
          <omgdc:Bounds x="399" y="263" width="66" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="edge_admin_skip_to_end" bpmnElement="flow_admin_skip_to_end">
        <omgdi:waypoint x="600" y="110" />
        <omgdi:waypoint x="714" y="110" />
        <omgdi:waypoint x="714" y="190" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="edge_admin_verify_to_end" bpmnElement="flow_admin_verify_to_end">
        <omgdi:waypoint x="600" y="310" />
        <omgdi:waypoint x="714" y="310" />
        <omgdi:waypoint x="714" y="218" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</definitions>
